/* Base styles */
:root{
  --bg:#ffffff; --text:#1b1b1b; --muted:#65707b; --accent:#0e7490; --card:#f8fafb;
}
:root[data-theme='dark']{ --bg:#0b1116; --text:#e6eef5; --muted:#9aa8b7; --accent:#38bdf8; --card:#071018 }
*{box-sizing:border-box}
html,body{height:100%}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); margin:0; line-height:1.6; font-size:var(--base-font-size,17px)}
.container{max-width:1100px;margin:0 auto;padding:2rem}
.site-header{border-bottom:1px solid rgba(0,0,0,.06);padding:1rem 0;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent)}
.site-title{font-family:'EB Garamond',serif;margin:0;font-weight:700;font-size:clamp(1.8rem,3vw,2.4rem);}
.site-subtitle{color:var(--muted);margin:0.25rem 0 0}
.header-controls{display:flex;gap:.5rem;margin-top:0.75rem}
.header-controls button{border:1px solid rgba(0,0,0,.06); background:transparent;padding:.5rem 0.7rem;border-radius:6px;cursor:pointer;color:var(--text)}
.header-controls #show-all-toggle{background: linear-gradient(90deg, rgba(14,116,144,0.06), rgba(14,116,144,0.12)); padding:.45rem .6rem;color:var(--text)}
.main-grid{display:grid;grid-template-columns:300px 1fr;gap:2rem;padding:2rem 0}
.toc{position:sticky;top:2.5rem;align-self:start;background:var(--card);padding:1rem;border-radius:8px;border:1px solid rgba(0,0,0,.04);width:260px;max-height:calc(100vh - 4rem);overflow:auto}
.toc ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.25rem}
.toc a{display:block;color:var(--accent);padding:.5rem 0.75rem;border-radius:6px;text-decoration:none;border:1px solid transparent}
.toc a:hover, .toc a:focus{background:rgba(0,0,0,0.02); outline: none}
.toc a[aria-current="true"]{font-weight:700;color:var(--text);background:var(--accent);border-color:transparent;color:white}
.longread{background:transparent}
.longread section{margin:2rem 0}

/* Default: show sections (graceful fallback if JS disabled). If JS runs, it will set .tabs-enabled on body */
.longread section{display:block}
.tabs-enabled .longread section{display:none}
.tabs-enabled .longread section.active{display:block}
.longread h2{font-family:'EB Garamond',serif;margin:0 0 0.6rem;font-size:1.4rem}
.dropcap::first-letter{float:left;font-family:'EB Garamond',serif;font-size:4rem;line-height:0.75;margin-right:.4rem;color:var(--accent);}
.ref{color:var(--muted);text-decoration:none}
.references{padding-left:1rem}
.site-footer{border-top:1px solid rgba(0,0,0,.04);padding:2rem;background:linear-gradient(0deg, rgba(0,0,0,0.02), transparent)}
.progress-wrap{position:fixed;left:0;right:0;top:0;height:4px;background:transparent;z-index:999}
.progress{height:4px;background:linear-gradient(90deg,var(--accent), #a78bfa); width:0%; transition:width 0.2s ease}
/* Responsive */
@media (max-width: 944px){.main-grid{grid-template-columns:1fr}.toc{position:static;margin-bottom:1rem}}
/* Dark-theme friendly borders */
:root[data-theme='dark'] .site-header{border-bottom-color:rgba(255,255,255,0.02)}
:root[data-theme='dark'] .toc{border-color:rgba(255,255,255,0.04)}
.header-controls button{transition: color 150ms ease, border-color 150ms ease}
:root[data-theme='dark'] .header-controls button{border-color:rgba(255,255,255,0.06)}
/* Highlighting current toc entry */
.toc a.active{font-weight:700;color:var(--text);background:rgba(0,0,0,0.03);padding-left:0.35rem;border-left:3px solid var(--accent);}
/* Small changes for typography */
.longread p{font-size:clamp(1rem,1.2vw,1.07rem);color:var(--text)}
.longread ul{padding-left:1.2rem}
/* Make images responsive */
figure{margin:0 0 1rem}
img{max-width:100%;height:auto;border-radius:8px}
/* TOC toggle for mobile */
/* #toc[hidden] not used: TOC is always visible as a left panel */
/* Reader-friendly column layout for larger screens */
@media (min-width: 1200px){
  .longread{column-width:40ch;column-gap:3rem}
  .longread h2, .longread ul, .longread figure, .longread .references{break-inside:avoid-column}
}

/* Small improvements */
.header-controls{align-items:center}
.skip-link{position:absolute;left:0;top:-40px;background:var(--accent);color:white;padding:8px 12px;border-radius:0 0 6px 0;z-index:1000}
.skip-link:focus{top:0}
figcaption{font-size:.9rem;color:var(--muted);margin-top:.4rem}

/* mobile default hide for toc (visibility handled by `hidden` attribute)
   Keep toc styled as block visually so toggling works */
@media (max-width: 944px){
  /* Keep TOC visible as a panel on all screens; if needed, we can add responsive behavior later */
  #toc{display:block}
  .header-controls {justify-content:flex-end}
}

/* print friendly */
@media print{
  .header-controls{display:none}
  .toc{display:none}
  .progress-wrap{display:none}
  body{background:white;color:black}
}

/* Reveal animation */
.reveal{opacity:0;transform:translateY(10px);transition:opacity 500ms ease, transform 600ms ease}
.reveal.in-view{opacity:1;transform:translateY(0)}
/* Ensure revealed elements inside the currently active section are visible when using tabs */
.tabs-enabled .longread section.active .reveal{opacity:1;transform:translateY(0)}
.media-row{display:flex;gap:1rem;align-items:flex-start}
.media-row figure{flex:1}
.video-embed{flex:1}

/* Ensure Web3 section stacks media vertically so the image is full-width and video sits below */
#web3 .media-row{flex-direction:column}
#web3 .media-row figure, #web3 .media-row .video-embed{flex:none;width:100%}
#web3 .video-embed iframe{width:100%;height:auto;aspect-ratio:16/9;border-radius:8px}
#web3 .video-embed{margin-top:1rem}

/* Decentralized storage: text, then image, then video under image */
#decentralized-storage figure, #decentralized-storage .video-embed{width:100%; break-inside:avoid-column}
#decentralized-storage .video-embed iframe{width:100%;height:auto;aspect-ratio:16/9;border-radius:8px}
#decentralized-storage .video-embed{margin-top:1rem}
#web3 .video-embed{margin-top:1rem}
.chart-wrap{margin-top:1rem}
.muted{color:var(--muted);font-size:.95rem}

/* Chapter tabs */
/* previously used top tabs were removed; navigation is via left-side TOC */
